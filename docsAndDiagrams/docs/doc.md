# Campaign Performance System Overview
>
>
Responsible of taking the events of click, views and other interaction and tracking the campaign perforamnce.
Also responsible for charging clicks and adjusting budgets for active campaigns

## System Context

In the following diagram, we can see how does our service interacts with rest of the services. 

> ![](embed:CPS-SystemContext)
>
> 
Each of the services are explained below:

| Service                     | Description                                                                                                                    |
|-----------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| Campaign Management Service | Responsible for managing the e2e flow of campaigns i.e pre-creation recommendation, creation and edit, campaign pause and stop |
| Ads Payment Service         | Bulk fetches data from presto and bulk pushes data to kafka                                                                    |
| Presto                      | Responsible for having data generated by analytical model or sending data back for analytics                                   |
| Ingestion Kafka             | Responsible for having data generated by analytical model or sending data back for analytics                                   |

## Deployments

| EKS Service Name              | Description                                                          | Criticality |
|-------------------------------|----------------------------------------------------------------------|-------------|
| campaign-performace-new       | Tracks performance of a campaign                                     | P0          |
| campaign-performace-cron      | Bulk fetches data from presto and bulk pushes data to kafka          | P1          |
| campaign-performance-consumer | Consumes data from ingestion kafka and populates in relevant source  | P0          |

## System Architecture

> ![](embed:CPS-Containers)

## Components

### API component
![](embed:API-Application)

### Listener component

### Scheduler component
![](embed:Schedulers)


## Databases

| Cluster name                             | Type   | Short description                                                                                                                                                                                                       |
|------------------------------------------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| bac-p-advertisement-new                  | MYSQL  | Primarily stores campaigns and related entities                                                                                                                                                                         |
| advertisement-serving                    | Redis  | Caches fallback feed & Reco RE feed. Also caches campaign details required in serving flow. User sessions required for pagination are also stored here                                                                  |
| advertisement-views                      | Redis  | Stores daily user-catalog view counts. These are used in serving flow to filter out catalogs which are already seen by the user on that day                                                                             |
| bac-p-advertisement-reco-hbase-v2        | Hbase  | Consists of similar catalogs data generated by DS team to serve on Reco RE                                                                                                                                              |
| bac-p-advertisement-collections-hbase-v3 | Hbase  | - Stores Collections & CLP feed generated by DS team<br/>  - Stores bids of catalogs that are enabled for Auto CPC                                                                                                      |                                                                                                
| bac-p-advertisement-hbase                | Hbase  | - Stores RE agnostic data required in serving flow(Ex: fallback feed scores, CPC normalization constants)<br/> - Also stores recommendations shown in supplier panel at various stages(Ex: budget recomendation..etc)   |                                                                                                
| bac-p-advertisement                      | ES     | Contains index of catalog data with all attributes(price,rating,cpc,feed scores..etc. Used for generating fallback feed for FY/CLP/Collections. Also used for applying feed filters given by user on personalized feed) |                                                                                                
| bac-p-advertisement-text-search          | ES     | Contains index of catalog data with all attributes required for text-searh(name,description,price,rating,cpc,feed scores..etc. Used for generating fallback feed for tex-search serving                                 |                                                                                                
| bac-p-advertisement-spark-clp-collection | Spark  | Used for bulkloading Collections & CLP provided by DS team into Hbase                                                                                                                                                   |                                                                                                
| bac-p-advertisement-spark                | Spark  | Used for bulkloading Reco real-estate DS feed into Hbase                                                                                                                                                                |                                                                                                
| meesho-p-ads                             | S3     | Used as medium to share feeds between DS team and Ads team                                                                                                                                                              |                                                                                                
| ads-feed-trigger                         | Lambda | Used for automatically triggering Spark jobs upon arrival of new DS feeds                                                                                                                                               |                                                                                                



## Other resources

Ads confluence - https://meesho.atlassian.net/wiki/spaces/EW/pages/1360134195/Ads+Pod

Grafana dashboard - https://grafana.meesho.com/d/OWhpWwsGz/adserver?orgId=1

## Authors / Code Review
Apurva Jha <apurva.jha@meesho.com> ,
Amit Poonia <amit.poonia@meesho.com>